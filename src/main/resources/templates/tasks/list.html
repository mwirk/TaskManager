<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>Your tasks</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body style="font-family: Arial, sans-serif; background: #f5f7fa; margin: 0;">

<div layout:fragment="content" class="container my-4 p-4 bg-white rounded shadow-sm">

    <h2 class="text-center mb-4" style="font-size:26px; color:#333;">Your tasks</h2>


    <form th:action="@{/tasks}" method="get" class="row g-3 mb-4 p-3 bg-light rounded">
        <div class="col-md-3">
            <label class="form-label fw-bold">Title:</label>
            <input type="text" name="title" class="form-control">
        </div>

        <div class="col-md-3">
            <label class="form-label fw-bold">Sort by:</label>
            <select name="sort" class="form-select">
                <option value="">-- sort by --</option>
                <option>Status</option>
                <option>Due date</option>
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label fw-bold">Category:</label>
            <select name="category" class="form-select">
                <option value="">-- choose category --</option>
                <option th:each="cat : ${categories}"
                        th:value="${cat.id}"
                        th:text="${cat.name}">
                </option>
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label fw-bold">Status:</label>
            <select name="status" class="form-select">
                <option value="">-- choose status --</option>
                <option th:each="status : ${statuses}"
                        th:value="${status}"
                        th:text="${status}">
                </option>
            </select>
        </div>

        <div class="col-12">
            <button type="submit" class="btn btn-success fw-bold">Search</button>
        </div>
    </form>

    <div class="d-flex gap-2 mb-4">
        <a href="/tasks/add" class="btn btn-primary fw-bold">+ Add new task</a>
        <a th:href="@{/categories/add}" class="btn btn-primary fw-bold">+ Add new category</a>
    </div>

    <div class="d-flex gap-3 mb-3">
        <span class="badge bg-secondary">
        TOTAL: <span th:text="${to_doCounter + in_progressCounter + doneCounter}"></span>
        </span>

        <span class="badge bg-secondary">TO_DO: <span th:text="${to_doCounter}"></span></span>
        <span class="badge bg-secondary">IN_PROGRESS: <span th:text="${in_progressCounter}"></span></span>
        <span class="badge bg-secondary">DONE: <span th:text="${doneCounter}"></span></span>
    </div>


    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle">
            <thead class="table-light">
            <tr>
                <th>Title</th>
                <th>Category</th>
                <th>Status</th>
                <th>Due date</th>
                <th>Done %</th>
                <th></th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="task : ${tasks}">
                <td th:text="${task.title}"></td>
                <td>
                    <span th:text="${task.categoryId.name}"
                          th:style="'background-color:' + ${task.categoryId.color} + '; padding:2px 6px; border-radius:4px;'"></span>
                </td>
                <td th:text="${task.status}"></td>
                <td th:text="${#temporals.format(task.dueDate, 'dd.MM.yyyy HH:mm')}"></td>
                <td th:text="${#numbers.formatDecimal(task.donePercentage, 1, 1)} + '%'"></td>
                <td>
                    <form th:action="@{'/tasks/edit/' + ${task.id}}" method="get">
                        <button type="submit" class="btn btn-warning btn-sm fw-bold">Edit</button>
                    </form>
                </td>
                <td>
                    <form th:action="@{'/tasks/delete/' + ${task.id}}" method="post">
                        <button type="submit" class="btn btn-danger btn-sm fw-bold">Delete</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div style="margin-top: 1em;">
        <a th:if="${currentPage > 0}"
           th:href="@{/tasks(page=${currentPage - 1})}">Previous</a>

        <span th:text="${currentPage + 1}"></span> / <span th:text="${totalPages}"></span>

        <a th:if="${currentPage + 1 < totalPages}"
           th:href="@{/tasks(page=${currentPage + 1})}">Next</a>
    </div>

</div>

</body>
</html>
